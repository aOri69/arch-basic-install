ls /usr/share/kbd/keymaps/**/*.map.gz
loadkeys ru
ls /sys/firmware/efi/efivars
timedatectl set-ntp true


gdisk /dev/sda
n/ENTER/+512M/ef00
n/ENTER/ENTER/ENTER

mkfs.vfat /dev/sda1
mkfs.btrfs /dev/sda2

mount /dev/sda2 /mnt
cd /mnt
btrfs su cr @
btrfs su cr @home
btrfs su cr @var
btrfs su cr @snapshots

cd
umount /mnt
mount -o noatime,compress=zstd,space_cache,discard=async,subvol=@ /dev/sda2 /mnt
mkdir /mnt/{efi,home,var,.snapshots}
mount -o noatime,compress=zstd,space_cache,discard=async,subvol=@home /dev/sda2 /mnt/home
mount -o noatime,compress=zstd,space_cache,discard=async,subvol=@var /dev/sda2 /mnt/var
mount -o noatime,compress=zstd,space_cache,discard=async,subvol=@snapshots /dev/sda2 /mnt/.snapshots
mount /dev/sda1 /mnt/efi

pacstrap /mnt base linux linux-firmware vim git amd-ucode btrfs-progs

genfstab -U /mnt >> /mnt/etc/fstab
arch-chroot /mnt
ln -sf /usr/share/zoneinfo/Europe/Moscow /etc/localtime
hwclock --systohc

/etc/locale.gen
locale-gen

echo "LANG=ru_RU.UTF-8" >> /etc/locale.conf
echo "KEYMAP=ru" >> /etc/vconsole.conf
echo "FONT=cyr-sun16" >> /etc/vconsole.conf
echo "arch" >> /etc/hostname
echo "127.0.0.1 localhost" >> /etc/hosts
echo "::1       localhost" >> /etc/hosts
echo "127.0.1.1 arch.localdomain arch" >> /etc/hosts

passwd

useradd -mG wheel asokolov
passwd asokolov

pacman -S grub grub-btrfs os-prober efibootmgr networkmanager network-manager-applet dialog wpa_supplicant mtools dosfstools reflector base-devel linux-headers avahi xdg-user-dirs xdg-utils gvfs gvfs-smb nfs-utils inetutils dnsutils bluez bluez-utils cups alsa-utils pipewire pipewire-alsa pipewire-pulse pipewire-jack pavucontrol bash-completion openssh rsync reflector acpi acpi_call tlp virt-manager qemu qemu-arch-extra edk2-ovmf bridge-utils dnsmasq vde2 openbsd-netcat iptables-nft ipset firewalld flatpak sof-firmware nss-mdns acpid os-prober ntfs-3g terminus-font

# pacman -S --noconfirm xf86-video-amdgpu
# pacman -S --noconfirm nvidia nvidia-utils nvidia-settings

grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=GRUB
grub-mkconfig -o /boot/grub/grub.cfg

systemctl enable NetworkManager
systemctl enable bluetooth
systemctl enable cups.service
systemctl enable sshd
systemctl enable tlp # You can comment this command out if you didn't install tlp, see above
systemctl enable reflector.timer
systemctl enable fstrim.timer
systemctl enable libvirtd
systemctl enable acpid

usermod -aG libvirt asokolov

echo "asokolov ALL=(ALL) ALL" >> /etc/sudoers.d/asokolov

git clone https://aur.archlinux.org/paru
cd paru
makepkg -si
cd..

paru -S zramd
sudo vim /etc/default/zramd
systemctl enable --now zramd

paru -S timeshift timeshift-autosnap
